<!DOCTYPE html>
<html>

  <head>

      
    <!-- Molstar CSS & JS -->
    <link rel="stylesheet" type="text/css" href="build/pdbe-molstar-0.1.2.css">
    <script type="text/javascript" src="build/pdbe-molstar-plugin-0.1.2.js"></script>

    <link rel="stylesheet" type="text/css" href="https://www.ebi.ac.uk/pdbe/pdb-component-library/v1.0/css/molstar-light-0.0.1.css">

    <link rel="stylesheet" type="text/css" href="https://pdbe.gitdocs.ebi.ac.uk/web-components/ligand-env/pdb-ligand-env-svg.css">
    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <script type="text/javascript" src="https://pdbe.gitdocs.ebi.ac.uk/web-components/ligand-env/pdb-ligand-env-component-0.2.0-min.js"></script>

    <style>
      #myViewer{
        float:left;
        width:450px;
        height: 450px;
        position:relative;
      }
    </style>
  </head>

  <body>
    <h3>PDBe Molstar Plugin demo - Basic</h3>
    
    <!-- Molstar container -->
    <div style="position: relative; float:left;">
      <div id="myViewer"></div>

      <div style="border: 1px solid #ccc9c0;height:450px;position:relative; width:450px; float:right;margin-left:20px;">
        <!-- <pdb-ligand-env id="int-component" pdb-id="3d12" pdb-chain-id="J_2" pdb-res-id="2" zoom-on></pdb-ligand-env> -->
        <pdb-ligand-env pdb-id="2aw3" bound-molecule-id="bm2" entity-id="2" zoom-on></pdb-ligand-env>
      </div>
    </div>
    
    <!-- Actions Menu -->
    <div style="float:right; border:1px solid lightgray; width:300px;padding:10px;">

      <button onclick="viewerInstance.visual.update({ moleculeId: '2aw3', ligandView: { label_comp_id: 'PLP', auth_asym_id: 'A_1', auth_seq_id: 900 } })">Update ligand</button>

      <button onclick="updateBranchedPolymer()">Update branched polymer</button>
      
      <h3><u>Canvas/ layout methods</u></h3>
      
      <strong>Set Background</strong><br>
      <button onclick="viewerInstance.canvas.setBgColor({r:255, g:255, b:255})">White</button>&nbsp;
      <button onclick="viewerInstance.canvas.setBgColor({r:0, g:0, b:0})">Black</button><br><br>
      
      <strong>Toggle controls menu</strong><br>
      <button onclick="viewerInstance.canvas.toggleControls(false)">Hide</button>&nbsp;
      <button onclick="viewerInstance.canvas.toggleControls(true)">Show</button>&nbsp;
      <button onclick="viewerInstance.canvas.toggleControls()">Toggle</button><br><br>
      
      <strong>Toggle Fullscreen</strong><br>
      <button onclick="viewerInstance.canvas.toggleExpanded(true)">Show Fullscreen</button><br>
      
      <h3><u>Visual Methods</u></h3>
      <strong>Change the visual entities visibility</strong><br>
      <button onclick="viewerInstance.visual.visibility({water:false})">Hide Water Visual</button>&nbsp;
      <button onclick="viewerInstance.visual.visibility({water:true})">Show Water Visual</button><br><br>

      <strong>Toggle Spin</strong><br>
      <button onclick="viewerInstance.visual.toggleSpin(true)">Rotate</button>&nbsp;
      <button onclick="viewerInstance.visual.toggleSpin(false)">Stop</button>&nbsp;
      <button onclick="viewerInstance.visual.toggleSpin()">Toggle</button><br><br>
      
      <strong>Focus</strong><br>
      <button onclick="viewerInstance.visual.focus([{struct_asym_id: 'A', start_residue_number: 14, end_residue_number: 18}])">Focus on Chain A:14-18</button><br><br>
      
      <strong>Selection</strong><br>
      <button onclick="viewerInstance.visual.selection([{struct_asym_id: 'B', start_residue_number: 1, end_residue_number: 6, color:{r:255,g:255,b:0}}], {r:255,g:255,b:255}, true)">Select & Focus on Chain B:1-6</button><br><br>
      <button onclick="
        var selectSections = [
          {
            struct_asym_id: 'B', 
            start_residue_number: 8, 
            end_residue_number: 10, 
            color:{r:255,g:0,b:255}
          },
          {
            struct_asym_id: 'B', 
            start_residue_number: 2, 
            end_residue_number: 5, 
            color:{r:255,g:0,b:0}
          }
        ]
        viewerInstance.visual.selection(selectSections, {r:255,g:255,b:255}, false)">Select on Chain B:2-5 & Chain B:8-10</button><br><br>
        
        <button onclick="viewerInstance.visual.selection([{struct_asym_id: 'B', color:{r:255,g:255,b:0}}], {r:255,g:255,b:255}, true)">Select & Focus on Chain B</button><br><br>
      
      <strong>Reset Visual</strong><br>
      <button onclick="viewerInstance.visual.reset(true, false)">Camera</button>&nbsp;
      <button onclick="viewerInstance.visual.reset(false, true)">Theme</button>&nbsp;
      <button onclick="viewerInstance.visual.reset(true, true)">Camera & Theme</button><br><br>

      <strong>Update data</strong><br>
      <button onclick="viewerInstance.visual.update({moleculeId: '1cbs'})">Update data to create new visual</button><br><br>

      <h3><u>Interactivity Methods</u></h3>
      <strong>Highlight</strong><br>
      <button onclick="viewerInstance.interactivity.highlight([{struct_asym_id: 'A', start_residue_number: 14, end_residue_number: 18}])">Highlight Chain A:14-18</button>&nbsp;
      <button onclick="viewerInstance.interactivity.clearHighlight()">Clear Highlight</button><br><br>

      <strong>Selection</strong><br>
      <button onclick="viewerInstance.interactivity.select([{struct_asym_id: 'A', start_residue_number: 73, end_residue_number: 81}])">Select Chain A:73-81</button><br><br>
      <button onclick="viewerInstance.interactivity.select([{struct_asym_id: 'A', start_residue_number: 30, end_residue_number: 38, sideChain: true}])">Select Chain A:30-38 and show side-chain</button><br><br>
      <button onclick="viewerInstance.interactivity.clearSelection()">Clear Selection</button><br><br>
      
      
    </div>
    
    <script>
      //Create plugin instance
      var viewerInstance = new PDBeMolstarPlugin();

      // var options = {
      //   moleculeId: '3d12',
      //   ligandView: { label_comp_id: "NAG", auth_asym_id: "J_2", auth_seq_id: 2 },
      //   hideControls: true,
      //   loadMaps: true,
      //   bgColor: {r: 255, g: 255, b: 255},
      //   pdbeUrl: "https://wwwdev.ebi.ac.uk/pdbe/",
      // }
  
      var options = {
        bgColor: {r: 255, g: 255, b: 255},
        pdbeUrl: "https://wwwdev.ebi.ac.uk/pdbe/",
        moleculeId: '2aw3',
        hideControls: true,
        loadMaps: true,
        ligandView: {
          label_comp_id_list: {
            "atom_site": [
              {
                "auth_asym_id": "D_1",
                "auth_seq_id": 5
              },
              {
                "auth_asym_id": "D_1",
                "auth_seq_id": 4
              },
              {
                "auth_asym_id": "D_1",
                "auth_seq_id": 3
              },
              {
                "auth_asym_id": "D_1",
                "auth_seq_id": 2
              },
              {
                "auth_asym_id": "D_1",
                "auth_seq_id": 1
              }
            ],
            "radius": 5
          }
        }
      }

      //Get element from HTML/Template to place the viewer 
      var viewerContainer = document.getElementById('myViewer');
  
      //Call render method to display the 3D view
      viewerInstance.render(viewerContainer, options);

      var updateBranchedPolymer = () => {
        viewerInstance.visual.update(
          {
            moleculeId: '2aw3',
            ligandView: {
              label_comp_id_list: {
                atom_site: [
                  {
                    "auth_asym_id": "C_1",
                    "auth_seq_id": 5
                  },
                  {
                    "auth_asym_id": "C_1",
                    "auth_seq_id": 4
                  },
                  {
                    "auth_asym_id": "C_1",
                    "auth_seq_id": 3
                  },
                  {
                    "auth_asym_id": "C_1",
                    "auth_seq_id": 2
                  },
                  {
                    "auth_asym_id": "C_1",
                    "auth_seq_id": 1
                  }
                ],
                "radius": 5
              }
            }
          }
        )
      }
      
    </script>
  </body>

</html>